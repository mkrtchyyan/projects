CREATE  TABLE IF NOT EXISTS sa_offline_sales.src_offline_coffee_shop_transactions(
   "SALES_ID" VARCHAR(1000),
  "EVENT_DT" VARCHAR(1000),
  "CUSTOMER_ID" VARCHAR(1000),
  "PRODUCT_ID" VARCHAR(1000),
  "STORE_ID" VARCHAR(1000),
  "STAFF_ID" VARCHAR(1000),
  "PAYMENT_ID" VARCHAR(1000),
  "QUANTITY" VARCHAR(1000),
  "LINE_ITEM_AMOUNT" VARCHAR(1000),
  "COST" VARCHAR(1000),
  "PROFIT" VARCHAR(1000),
  "PROFIT_MARGIN" VARCHAR(1000),
  "CUSTOMER_FIRST_NAME" VARCHAR(1000),
  "CUSTOMER_LAST_NAME" VARCHAR(1000),
  "CUSTOMER_COUNTRY" VARCHAR(1000),
  "LOYALTY_MEMBER" VARCHAR(1000),
  "LOYALTY_DISCOUNT" VARCHAR(1000),
  "PRODUCT_GROUP" VARCHAR(1000),
  "PRODUCT_CATEGORY" VARCHAR(1000),
  "PRODUCT_TYPE" VARCHAR(1000),
  "PRODUCT_DESC" VARCHAR(1000),
  "PROMO_FLAG" VARCHAR(1000),
  "PROMO_DISCOUNT" VARCHAR(1000),
  "BASE_PRICE" VARCHAR(1000),
  "IS_LIMITED_EDITION" VARCHAR(1000),
  "STORE_DESC" VARCHAR(1000),
  "STORE_CITY" VARCHAR(1000),
  "STORE_COUNTRY" VARCHAR(1000),
  "STORE_ADDRESS" VARCHAR(1000),
  "STORE_FLOOR_AREA" VARCHAR(1000),
  "STORE_TYPE" VARCHAR(1000),
  "MANAGER_ID" VARCHAR(1000),
  "STAFF_FIRST_NAME" VARCHAR(1000),
  "STAFF_LAST_NAME" VARCHAR(1000),
  "STAFF_JOB_DESC" VARCHAR(1000),
  "JOB_START_DT" VARCHAR(1000),
  "EMPLOYMENT_STATUS" VARCHAR(1000),
  "HOURLY_WAGE" VARCHAR(1000),
  "PAYMENT_METHOD" VARCHAR(1000),
  "PAYMENT_PROVIDER" VARCHAR(1000),
  "TRANSACTION_FEE" VARCHAR(1000),
  "IS_CONTACTLESS" VARCHAR(1000),
  "DAY_OF_WEEK" VARCHAR(1000),
  "DAY_OF_MONTH" VARCHAR(1000),
  "WEEK_ID" VARCHAR(1000),
  "MONTH_ID" VARCHAR(1000),
  "MONTH_DESC" VARCHAR(1000),
  "QUARTER_ID" VARCHAR(1000),
  "QUARTER_DESC" VARCHAR(1000),
  "YEAR_ID" VARCHAR(1000),
  "IS_WEEKEND" VARCHAR(1000));
COMMIT;

------------------------------------------------------------------
INSERT INTO sa_offline_sales.src_offline_coffee_shop_transactions
SELECT   
  "SALES_ID",
  "EVENT_DT",
  "CUSTOMER_ID",
  "PRODUCT_ID",
  "STORE_ID",
  "STAFF_ID",
  "PAYMENT_ID",
  "QUANTITY",
  "LINE_ITEM_AMOUNT",
  "COST",
  "PROFIT",
  "PROFIT_MARGIN",
  "CUSTOMER_FIRST_NAME",
  "CUSTOMER_LAST_NAME",
  "CUSTOMER_COUNTRY",
  "LOYALTY_MEMBER",
  "LOYALTY_DISCOUNT",
  "PRODUCT_GROUP",
  "PRODUCT_CATEGORY",
  "PRODUCT_TYPE",
  "PRODUCT_DESC",
  "PROMO_FLAG",
  "PROMO_DISCOUNT",
  "BASE_PRICE",
  "IS_LIMITED_EDITION",
  "STORE_DESC",
  "STORE_CITY",
  "STORE_COUNTRY",
  "STORE_ADDRESS",
  "STORE_FLOOR_AREA",
  "STORE_TYPE",
  "MANAGER_ID",
  "STAFF_FIRST_NAME",
  "STAFF_LAST_NAME",
  "STAFF_JOB_DESC",
  "JOB_START_DT",
  "EMPLOYMENT_STATUS",
  "HOURLY_WAGE",
  "PAYMENT_METHOD",
  "PAYMENT_PROVIDER",
  "TRANSACTION_FEE",
  "IS_CONTACTLESS",
  "DAY_OF_WEEK",
  "DAY_OF_MONTH",
  "WEEK_ID",
  "MONTH_ID",
  "MONTH_DESC",
  "QUARTER_ID",
  "QUARTER_DESC",
  "YEAR_ID",
  "IS_WEEKEND" 
 FROM sa_offline_sales.ext_offline_coffee_shop_transactions ext
 WHERE ((ext."EVENT_DT">(SELECT COALESCE(MAX("EVENT_DT"),'0') FROM sa_offline_sales.src_offline_coffee_shop_transactions)) OR
((ext."EVENT_DT"::bigint=(SELECT COALESCE(MAX("EVENT_DT"::bigint),0) FROM sa_offline_sales.src_offline_coffee_shop_transactions) 
  AND ext."SALES_ID">(SELECT COALESCE(MAX("SALES_ID"),'INV-OFL-000000') FROM sa_offline_sales.src_offline_coffee_shop_transactions)))) AND
NOT EXISTS (SELECT 1 FROM sa_offline_sales.src_offline_coffee_shop_transactions WHERE "SALES_ID"=ext."SALES_ID") ;
COMMIT;
